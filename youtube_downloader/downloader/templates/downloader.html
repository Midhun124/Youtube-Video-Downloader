{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">
  </head>
<body>
<div class="container">
  <h1>Youtube video downloader</h1>
  <form id="video-form" method="post">
  {% csrf_token %}
  <label for="link">Enter URL:</label>
  <input type="text" id="link" name="link"><br><br>
  <input onclick='displayVideoDiv()' class="submit-btn" type="submit" value="Submit">
  </form>

  <div class="spinner-border" id="loading" style="display: none;" role="status">
    <span class="sr-only"></span>
  </div>

  <div class="video-display-container" style="display: none;">
    <span class="base-title">Download Video as:</span>
    <div class="video-display-content">
      <div class="left-block">
        <div>
          <div class="video-thumbnail-container">
            <img id="thumbnail" alt="Video thumbnail">
          </div>
          <div class="video-title-container">
            <h2 id="title"></h2>
          </div>
          <div class="video-duration-container">
            <p id="duration"></p>
          </div>
        </div>
      </div>
      <div class="block-divider"></div>
      <div class="right-block">
        <div>
          <div class="video-quality-container">
            <p id="quality"></p>
          </div>
        </div>
      </div>
    </div>
    <form id="download-btn" method="post" action="{% url 'download_video' %}">
      {% csrf_token %}
      <input class="submit-btn" type="submit" value="Download">
    </form>
  </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  $(document).ready(function(){
    var displayContainer = document.querySelector('.video-display-container');
    function displayVideoDiv() {
      displayContainer.style.display = 'block';
    }
  
    $("#video-form").submit(function(e){
      e.preventDefault();
      // Show the loading spinner
      $("#loading").show();
      $.ajax({
        url: '/get_video_properties/',  // Update with the correct URL
        type: 'post',
        data: $(this).serialize(),
        success: function(data){
          // Hide the loading spinner
          $("#loading").hide();
          // Display the video properties
          displayVideoDiv();
          $("#title").text(data.title);
          $("#duration").text("Duration: " + data.duration + " seconds");
          $("#thumbnail").attr("src", data.thumbnail_url);
          $("#quality").text("Quality: " + data.quality);
        }
      });
    });
  });  
</script>

</body>
</html>